<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Queries | Alan.dart</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/alan.dart/assets/logo.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/alan.dart/assets/pwa/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/alan.dart/assets/pwa/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/alan.dart/assets/pwa/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/alan.dart/assets/pwa/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/alan.dart/assets/pwa/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/alan.dart/assets/pwa/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/alan.dart/assets/pwa/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/alan.dart/assets/pwa/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/alan.dart/assets/pwa/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/alan.dart/assets/pwa/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/alan.dart/assets/pwa/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/alan.dart/assets/pwa/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/alan.dart/assets/pwa/favicon-16x16.png">
    <link rel="manifest" href="/alan.dart/assets/pwa/manifest.json">
    <meta name="description" content="Documentation for the Alan.dart SDK">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta property="og:title" content="Alan.dart documentation">
    <meta property="og:description" content="Learn how to use the Alan.dart SDK">
    <meta roperty="og:type" content="website">
    <meta property="og:locale" content="en_US">
    
    <link rel="preload" href="/alan.dart/assets/css/0.styles.4a76bf78.css" as="style"><link rel="preload" href="/alan.dart/assets/js/app.6ed8a6ea.js" as="script"><link rel="preload" href="/alan.dart/assets/js/2.d636a34c.js" as="script"><link rel="preload" href="/alan.dart/assets/js/11.872007a7.js" as="script"><link rel="prefetch" href="/alan.dart/assets/js/10.a9c7a63d.js"><link rel="prefetch" href="/alan.dart/assets/js/12.e8e85203.js"><link rel="prefetch" href="/alan.dart/assets/js/13.25d7bbcb.js"><link rel="prefetch" href="/alan.dart/assets/js/3.c9257ea3.js"><link rel="prefetch" href="/alan.dart/assets/js/4.030ce163.js"><link rel="prefetch" href="/alan.dart/assets/js/5.983396c3.js"><link rel="prefetch" href="/alan.dart/assets/js/6.ad245f27.js"><link rel="prefetch" href="/alan.dart/assets/js/7.40b1c636.js"><link rel="prefetch" href="/alan.dart/assets/js/8.bd141b9f.js"><link rel="prefetch" href="/alan.dart/assets/js/9.a0002499.js">
    <link rel="stylesheet" href="/alan.dart/assets/css/0.styles.4a76bf78.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/alan.dart/" class="home-link router-link-active"><img src="/alan.dart/assets/logo.png" alt="Alan.dart" class="logo"> <span class="site-name can-hide">Alan.dart</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/alan-sdk/alan.dart" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/alan-sdk/alan.dart" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/alan.dart/wallet/overview.html" class="sidebar-link">Creating a wallet</a></li><li><a href="/alan.dart/transactions/overview.html" class="sidebar-link">Performing a transaction</a></li><li><a href="/alan.dart/queries/overview.html" aria-current="page" class="active sidebar-link">Querying the chain</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/alan.dart/queries/overview.html#_1-get-the-modules-to-use" class="sidebar-link">1. Get the modules to use</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/alan.dart/queries/overview.html#a-using-standard-cosmos-modules" class="sidebar-link">A. Using standard Cosmos modules</a></li><li class="sidebar-sub-header"><a href="/alan.dart/queries/overview.html#b-using-custom-modules" class="sidebar-link">B. Using custom modules</a></li></ul></li><li class="sidebar-sub-header"><a href="/alan.dart/queries/overview.html#_2-build-the-query-clients" class="sidebar-link">2. Build the query clients</a></li><li class="sidebar-sub-header"><a href="/alan.dart/queries/overview.html#_3-query-the-data" class="sidebar-link">3. Query the data</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/alan.dart/queries/overview.html#common-data" class="sidebar-link">Common data</a></li></ul></li></ul></li><li><a href="/alan.dart/modules/overview.html" class="sidebar-link">Supported Cosmos modules</a></li><li><a href="/alan.dart/custom-chains/overview.html" class="sidebar-link">Working with custom chains</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="queries"><a href="#queries" class="header-anchor">#</a> Queries</h1> <p>Starting with <code>v0.40.x</code>, Cosmos has added the support to <a href="https://grpc.io/" target="_blank" rel="noopener noreferrer">gRPC<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> queries and declared that REST APIs will be outdated in future versions. For this reason, Alan.dart now only uses gRPC queries in order to get the data from the chain whenever possible. Below you can find instructions on how to use this new and more efficient way of querying your chain.</p> <h2 id="_1-get-the-modules-to-use"><a href="#_1-get-the-modules-to-use" class="header-anchor">#</a> 1. Get the modules to use</h2> <h3 id="a-using-standard-cosmos-modules"><a href="#a-using-standard-cosmos-modules" class="header-anchor">#</a> A. Using standard Cosmos modules</h3> <p>If you are building an application that wants to query only default Cosmos modules (eg. <code>x/bank</code>, <code>x/staking</code>, <code>x/slashing</code>, etc) you can simply use the <code>QueryClient</code> that are already contained inside Alan.dart.</p> <p>To do this, you can simply import the different already built-in modules:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:alan/proto/cosmos/auth/v1beta1/export.dart'</span></span> <span class="token operator">as</span> auth<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:alan/proto/cosmos/bank/v1beta1/export.dart'</span></span> <span class="token operator">as</span> bank<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:alan/proto/cosmos/slashing/v1beta1/export.dart'</span></span> <span class="token operator">as</span> slashing<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>As you can see, the pattern used to import a module is the following:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:alan/proto/cosmos/&lt;module name&gt;/v1beta1/export.dart'</span></span> <span class="token operator">as</span> <span class="token generics"><span class="token punctuation">&lt;</span>module name<span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>If you want to see all the supported modules, please visit the <a href="/alan.dart/modules/overview.html">modules page</a></p> <h3 id="b-using-custom-modules"><a href="#b-using-custom-modules" class="header-anchor">#</a> B. Using custom modules</h3> <p>If you want to use Alan.dart to work on a custom chain, then you will need to generate the gRPC clients starting from your custom Protobuf files. If you want to know how to do this, please reference the <a href="/alan.dart/custom-chains/overview.html">custom chains</a> page.</p> <h2 id="_2-build-the-query-clients"><a href="#_2-build-the-query-clients" class="header-anchor">#</a> 2. Build the query clients</h2> <p>Once you have imported the module that you would like to use, you now need to build a <code>QueryClient</code> instance. To do this you have to:</p> <ol><li>create a <code>ClientChannel</code> connection towards a gRPC endpoint;</li> <li>build the <code>QueryClient</code> instance.</li></ol> <p>In order to create a <code>ClientChannel</code> connection, the esiest way is to use an already existing <code>NetworkInfo</code> object:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">final</span> networkInfo <span class="token operator">=</span> <span class="token class-name">NetworkInfo</span><span class="token punctuation">.</span><span class="token function">fromSingleHost</span><span class="token punctuation">(</span>
    bech32Prefix<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'cosmos'</span></span><span class="token punctuation">,</span> 
    host<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'localhost'</span></span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> channel <span class="token operator">=</span> networkInfo<span class="token punctuation">.</span>gRPCChannel<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Once you have created a <code>ClientChannel</code>, you can use it to create the <code>QueryClient</code> instances:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">final</span> authClient <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">auth<span class="token punctuation">.</span></span>QueryClient</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> bankClient <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">bank<span class="token punctuation">.</span></span>QueryClient</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> stakingClient <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">staking<span class="token punctuation">.</span></span>QueryClient</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">Reuse the same channel</p> <p>If you want to improve the efficiency of your application, you should reuse the same channel when creating different query clients. This will make sure that your application keeps alive only the bare minimum number of gRPC connections towards your node, instead of opening a lot of them.</p></div> <h2 id="_3-query-the-data"><a href="#_3-query-the-data" class="header-anchor">#</a> 3. Query the data</h2> <p>Once you have your <code>QueryClient</code> instance ready, you can now start querying the data. To do this, simply call the different <code>QueryClient</code> methods with the proper parameters:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:alan/proto/cosmos/staking/v1beta1/export.dart'</span></span> <span class="token operator">as</span> staking<span class="token punctuation">;</span>

<span class="token comment">// Create the pagination data</span>
<span class="token keyword">final</span> pagination <span class="token operator">=</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span>limit <span class="token operator">=</span> <span class="token number">100.</span><span class="token function">toInt64</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span>offset <span class="token operator">=</span> <span class="token number">0.</span><span class="token function">toInt64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Query the gRPC</span>
<span class="token keyword">final</span> response <span class="token operator">=</span> <span class="token keyword">await</span> stakingClient<span class="token punctuation">.</span><span class="token function">validators</span><span class="token punctuation">(</span>
  <span class="token class-name"><span class="token namespace">staking<span class="token punctuation">.</span></span>QueryValidatorsRequest</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span>status <span class="token operator">=</span> status
    <span class="token punctuation">.</span><span class="token punctuation">.</span>pagination <span class="token operator">=</span> pagination<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get the validators</span>
<span class="token keyword">final</span> validators <span class="token operator">=</span> response<span class="token punctuation">.</span>validators<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="common-data"><a href="#common-data" class="header-anchor">#</a> Common data</h3> <p>A lot of the different <code>QueryClient</code> methods accept common parameters. Following you can find some examples and how to use them properly.</p> <h4 id="pagination"><a href="#pagination" class="header-anchor">#</a> Pagination</h4> <p>Most of the methods that return a list of objects accept a pagination object that describes the number of results that should be returned and the offset from which to start counting such limit. To build this object you can use the following code:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">final</span> pagination <span class="token operator">=</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span>limit <span class="token operator">=</span> limit<span class="token punctuation">.</span><span class="token function">toInt64</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span>offset <span class="token operator">=</span> offset<span class="token punctuation">.</span><span class="token function">toInt64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Where <code>limit</code> and <code>offset</code> are <code>int</code> objects.</p> <p>As an example, to query the second page of 200 items, you can use the following pagination:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">final</span> pagination <span class="token operator">=</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span>limit <span class="token operator">=</span> <span class="token number">200.</span><span class="token function">toInt64</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment">// Return only 200 items</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span>offset <span class="token operator">=</span> <span class="token number">200.</span><span class="token function">toInt64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Skip the first 200 items (first page)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>In general, the formula to compute the <code>offset</code> given a non-zero page number (starting from 1) should be</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>offset = (page - 1) * limit
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="height"><a href="#height" class="header-anchor">#</a> Height</h4> <p>All queries support specifying a block height to query for. This is done using gRPC headers, and in particular the custom one named <code>x-cosmos-block-height</code>. To use this properly, you need to include this header inside a <code>CallOptions</code> object. To make this simpler, Alan.dart provides you with a helper method to build it simply:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">final</span> heightOption <span class="token operator">=</span> <span class="token class-name">GrpcHeaders</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Once you created the header, you can use it simply by passing it to the query client method that you want to use:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">final</span> response <span class="token operator">=</span> <span class="token keyword">await</span> stakingClient<span class="token punctuation">.</span><span class="token function">validators</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> heightOption<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/alan-sdk/alan.dart/edit/master/docs/queries/overview.md" target="_blank" rel="noopener noreferrer">Edit this page on Github</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/25/2022, 9:33:11 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/alan.dart/transactions/overview.html" class="prev">
        Performing a transaction
      </a></span> <span class="next"><a href="/alan.dart/modules/overview.html">
        Supported Cosmos modules
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/alan.dart/assets/js/app.6ed8a6ea.js" defer></script><script src="/alan.dart/assets/js/2.d636a34c.js" defer></script><script src="/alan.dart/assets/js/11.872007a7.js" defer></script>
  </body>
</html>
